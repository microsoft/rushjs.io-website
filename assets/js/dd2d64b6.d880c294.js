"use strict";(self.webpackChunkrushjs_io=self.webpackChunkrushjs_io||[]).push([[4668],{158:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>m});var n=r(6393);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=n.createContext({}),c=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(r),h=o,m=u["".concat(l,".").concat(h)]||u[h]||d[h]||a;return r?n.createElement(m,i(i({ref:t},p),{},{components:r})):n.createElement(m,i({ref:t},p))}));function m(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:o,i[1]=s;for(var c=2;c<a;c++)i[c]=r[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}h.displayName="MDXCreateElement"},5117:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>c,toc:()=>u});var n=r(9122),o=r(2501),a=(r(6393),r(158)),i=["components"],s={title:'The "rush-lib" API'},l=void 0,c={unversionedId:"pages/extensibility/api",id:"pages/extensibility/api",title:'The "rush-lib" API',description:"Rush provides an API for use by automation scripts. It is documented in the integrated API reference for all Rush Stack projects:",source:"@site/docs/pages/extensibility/api.md",sourceDirName:"pages/extensibility",slug:"/pages/extensibility/api",permalink:"/pages/extensibility/api",draft:!1,editUrl:"https://github.com/microsoft/rushstack-websites/tree/main/websites/rushjs.io/docs/pages/extensibility/api.md",tags:[],version:"current",frontMatter:{title:'The "rush-lib" API'},sidebar:"docsSidebar",previous:{title:"Creating Rush plugins (experimental)",permalink:"/pages/extensibility/creating_plugins"},next:{title:"rushx",permalink:"/pages/commands/rushx"}},p={},u=[{value:"Reading the rush.json configuration",id:"reading-the-rushjson-configuration",level:2},{value:"Modifying package.json files",id:"modifying-packagejson-files",level:2},{value:"Generating a README.md summary",id:"generating-a-readmemd-summary",level:2}],d={toc:u},h="wrapper";function m(e){var t=e.components,r=(0,o.Z)(e,i);return(0,a.kt)(h,(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Rush provides an API for use by automation scripts. It is documented in the integrated API reference for all Rush Stack projects:"),(0,a.kt)("p",null,"\xa0","\xa0","\xa0","\xa0"," ",(0,a.kt)("a",{parentName:"p",href:"https://api.rushstack.io/pages/rush-lib/"},"API Reference: @microsoft/rush-lib package")),(0,a.kt)("p",null,"Below are some usage examples."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Although these code samples are presented as plain JavaScript, we strongly recommend to use TypeScript and model your scripts as regular Rush projects. It is more work to set up initially, but it generally saves time and simplifies maintenance in the long run.")),(0,a.kt)("h2",{id:"reading-the-rushjson-configuration"},"Reading the rush.json configuration"),(0,a.kt)("p",null,"Rather than trying to load ",(0,a.kt)("strong",{parentName:"p"},"rush.json")," as a JSON file, it is recommended to use the ",(0,a.kt)("a",{parentName:"p",href:"https://api.rushstack.io/pages/rush-lib.rushconfiguration/"},"RushConfiguration")," class which provides a richer set of data views."),(0,a.kt)("p",null,"For example, this script will show all the Rush projects and their folders:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"const rushLib = require('@microsoft/rush-lib');\n\n// loadFromDefaultLocation() will search parent folders to find \"rush.json\" and then\n// take care of parsing it and loading related config files.\nconst rushConfiguration = rushLib.RushConfiguration.loadFromDefaultLocation({\n  startingFolder: process.cwd()\n});\n\nfor (const project of rushConfiguration.projects) {\n  console.log(project.packageName + ':');\n  console.log('  ' + project.projectRelativeFolder);\n}\n")),(0,a.kt)("h2",{id:"modifying-packagejson-files"},"Modifying package.json files"),(0,a.kt)("p",null,"If you want to modify a ",(0,a.kt)("strong",{parentName:"p"},"package.json")," file, the ",(0,a.kt)("a",{parentName:"p",href:"https://api.rushstack.io/pages/rush-lib.packagejsoneditor/"},"PackageJsonEditor")," class provides helpful validation and normalization:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"const rushLib = require('@microsoft/rush-lib');\n\nconst rushConfiguration = rushLib.RushConfiguration.loadFromDefaultLocation({\n  startingFolder: process.cwd()\n});\n\n// This will find \"@rushstack/ts-command-line\" in rush.json, without needing to specify the NPM scope\nconst project = rushConfiguration.findProjectByShorthandName('ts-command-line');\n\n// Add lodash as an optional dependency\nproject.packageJsonEditor.addOrUpdateDependency('lodash', '4.17.15', 'optionalDependencies');\n\n// Save the modified package.json file\nproject.packageJsonEditor.saveIfModified();\n")),(0,a.kt)("h2",{id:"generating-a-readmemd-summary"},"Generating a README.md summary"),(0,a.kt)("p",null,"For a more realistic example, the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/microsoft/rushstack/blob/main/repo-scripts/repo-toolbox/src/ReadmeAction.ts"},"repo-toolbox/src/ReadmeAction.ts")," tool uses these APIs to generate the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/microsoft/rushstack/blob/main/README.md#published-packages"},"README.md")," inventory for the Rush Stack monorepo."))}m.isMDXComponent=!0}}]);