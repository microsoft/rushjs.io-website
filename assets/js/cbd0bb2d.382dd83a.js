"use strict";(self.webpackChunkrushjs_io=self.webpackChunkrushjs_io||[]).push([[6202],{158:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>h});var n=r(6393);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var p=n.createContext({}),l=function(e){var t=n.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},c=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,p=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=l(r),g=a,h=m["".concat(p,".").concat(g)]||m[g]||u[g]||i;return r?n.createElement(h,s(s({ref:t},c),{},{components:r})):n.createElement(h,s({ref:t},c))}));function h(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,s=new Array(i);s[0]=g;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[m]="string"==typeof e?e:a,s[1]=o;for(var l=2;l<i;l++)s[l]=r[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}g.displayName="MDXCreateElement"},7075:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>p,default:()=>h,frontMatter:()=>o,metadata:()=>l,toc:()=>m});var n=r(9122),a=r(2501),i=(r(6393),r(158)),s=["components"],o={title:"NPM registry authentication"},p=void 0,l={unversionedId:"pages/maintainer/npm_registry_auth",id:"pages/maintainer/npm_registry_auth",title:"NPM registry authentication",description:"A private NPM registry enables your monorepo to publish NPM packages for internal usage. It works the same as",source:"@site/docs/pages/maintainer/npm_registry_auth.md",sourceDirName:"pages/maintainer",slug:"/pages/maintainer/npm_registry_auth",permalink:"/pages/maintainer/npm_registry_auth",draft:!1,editUrl:"https://github.com/microsoft/rushstack-websites/tree/main/websites/rushjs.io/docs/pages/maintainer/npm_registry_auth.md",tags:[],version:"current",frontMatter:{title:"NPM registry authentication"},sidebar:"docsSidebar",previous:{title:"Cobuilds (experimental)",permalink:"/pages/maintainer/cobuilds"},next:{title:"Authoring change logs",permalink:"/pages/best_practices/change_logs"}},c={},m=[{value:"Registry mappings",id:"registry-mappings",level:2},{value:"Prompting for credentials with &quot;rush setup&quot;",id:"prompting-for-credentials-with-rush-setup",level:2},{value:"See also",id:"see-also",level:2}],u={toc:m},g="wrapper";function h(e){var t=e.components,r=(0,a.Z)(e,s);return(0,i.kt)(g,(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"A ",(0,i.kt)("strong",{parentName:"p"},"private NPM registry")," enables your monorepo to publish NPM packages for internal usage. It works the same as\nthe public ",(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/"},"https://www.npmjs.com/")," registry, except that accessing the private registry\nrequires authorization. Each user will need to obtain an access token that typically gets stored in the\n",(0,i.kt)("a",{parentName:"p",href:"https://docs.npmjs.com/cli/v6/configuring-npm/npmrc"},"~/.npmrc file"),"\non their computer."),(0,i.kt)("p",null,"Most large monorepos eventually require a private NPM registry. It's useful for:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"sharing code privately between teams"),(0,i.kt)("li",{parentName:"ul"},"proxying access to the public registry, to improve reliability, audit package usage, and apply security screening"),(0,i.kt)("li",{parentName:"ul"},"speeding up CI operations by installing prebuilt tooling packages, instead of performing ",(0,i.kt)("inlineCode",{parentName:"li"},"rush install && rush build"),"\nbefore a tool can be invoked"),(0,i.kt)("li",{parentName:"ul"},"testing installation behaviors before publishing a package to public NPM registry"),(0,i.kt)("li",{parentName:"ul"},"publishing wrappers or temporary forks of third-party packages",(0,i.kt)("br",null),"\n(Compared to ",(0,i.kt)("a",{parentName:"li",href:"https://docs.npmjs.com/cli/v7/configuring-npm/package-json#github-urls"},"GitHub URL dependencies"),",\nNPM packages give you proper SemVer versioning and better caching semantics.)")),(0,i.kt)("p",null,"Some popular providers are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://aws.amazon.com/blogs/devops/publishing-private-npm-packages-aws-codeartifact/"},"AWS CodeArtifact")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/devops/artifacts/get-started-npm?view=azure-devops"},"Azure DevOps Artifacts")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/features/packages"},"GitHub Packages")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.gitlab.com/ee/user/packages/npm_registry/"},"GitLab Package Registry")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://jfrog.com/artifactory/"},"JFrog Artifactory")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.npmjs.com/about-private-packages"},"NPM private packages"))),(0,i.kt)("p",null,"And for testing purposes, ",(0,i.kt)("a",{parentName:"p",href:"https://verdaccio.org/"},"Verdaccio")," is a lightweight Node.js server that can run\non ",(0,i.kt)("inlineCode",{parentName:"p"},"http://localhost")," and implements a complete private registry with proxy capabilities."),(0,i.kt)("h2",{id:"registry-mappings"},"Registry mappings"),(0,i.kt)("p",null,"The mappings for your private registry are specified in\n",(0,i.kt)("a",{parentName:"p",href:"/pages/configs/npmrc"},"the monorepo .npmrc file"),"."),(0,i.kt)("p",null,"Below is an example configuration that installs company packages from the private\nregistry, but gets all other packages from the public registry. The company packages are\nidentified by their ",(0,i.kt)("inlineCode",{parentName:"p"},"@example")," NPM scope."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"common/config/rush/.npmrc")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'# Map your company\'s NPM scope ("@example") to the private registry URL:\n@example:registry=https://my-registry.example.com/npm-private/\n\n# Otherwise, all other packages come from the public NPM registry:\nregistry=https://registry.npmjs.org/\nalways-auth=false\n\n# Here we specify how the package manager should authenticate to the private registry.\n# For security reasons, CI jobs should obtain their tokens from environment variables.\n# The exact syntax depends on your registry provider.  If a line references an environment\n# variable that is undefined, Rush will ignore that line.  This avoids producing an invalid\n# string that might interfere with a developer who obtains their credentials from ~/.npmrc.\n//my-registry.example.com/npm-private/:_password=${MY_CI_TOKEN}\n//my-registry.example.com/npm-private/:username=${MY_CI_USER}\n//my-registry.example.com/npm-private/:always-auth=true\n')),(0,i.kt)("p",null,"More commonly, your private registry will act as a ",(0,i.kt)("strong",{parentName:"p"},"caching proxy")," so that it can provide\npackages from the public NPM registry as well. In this case, NPM scopes don't need to be mapped.\nYour setup might look like this:"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"common/config/rush/.npmrc")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# Map everything to the private registry URL\nregistry=https://my-registry.example.com/npm-private/\nalways-auth=true\n\n# Here we specify how the package manager should authenticate to the private registry.\n# For security reasons, CI jobs should obtain their tokens from environment variables.\n# The exact syntax depends on your registry provider.  If a line references an environment\n# variable that is undefined, Rush will ignore that line.  This avoids producing an invalid\n# string that might interfere with a developer who obtains their credentials from ~/.npmrc.\n//my-registry.example.com/npm-private/:_password=${MY_CI_TOKEN}\n//my-registry.example.com/npm-private/:username=${MY_CI_USER}\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"For details about the lookup precedence for ",(0,i.kt)("strong",{parentName:"p"},".npmrc")," settings,\nsee the ",(0,i.kt)("a",{parentName:"p",href:"/pages/configs/npmrc"},".npmrc")," page.")),(0,i.kt)("h2",{id:"prompting-for-credentials-with-rush-setup"},'Prompting for credentials with "rush setup"'),(0,i.kt)("p",null,"Rush recently introduced an experimental feature where ",(0,i.kt)("inlineCode",{parentName:"p"},"rush install")," can detect when a user's registry credentials\nare missing or expired. If so, they are asked to run ",(0,i.kt)("inlineCode",{parentName:"p"},"rush setup"),", which walks the user through the process of\nobtaining a token, and then updates their ",(0,i.kt)("strong",{parentName:"p"},"~/.npmrc")," file. The new settings will be intelligently merged with\nany existing contents of that file."),(0,i.kt)("p",null,"A sample ",(0,i.kt)("inlineCode",{parentName:"p"},"rush setup")," interaction looks like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'NPM credentials are missing or expired\n\n==> Fix this problem now? (y/N) Yes\n\nThis monorepo consumes packages from an Artifactory private NPM registry.\n\n==> Do you already have an Artifactory user account? (y/n) Yes\n\nPlease open this URL in your web browser:\n\n  https://my-company.jfrog.io/\n\nYour user name appears in the upper-right corner of the JFrog website.\n\n==> What is your Artifactory user name? example-user\n\nClick "Edit Profile" on the JFrog website.  Click the "Generate API Key" button if you haven\'t already done so\npreviously.\n\n==> What is your Artifactory API key? ***************\n\nFetching an NPM token from the Artifactory service...\n\nAdding Artifactory token to: /home/example-user/.npmrc\n')),(0,i.kt)("p",null,"The initial implementation supports the ",(0,i.kt)("a",{parentName:"p",href:"https://jfrog.com/artifactory/"},"JFrog Artifactory")," service only.\nOther services will be implemented in the future."),(0,i.kt)("p",null,"To use this feature, simply assign the ",(0,i.kt)("inlineCode",{parentName:"p"},'"registryUrl"')," field and set ",(0,i.kt)("inlineCode",{parentName:"p"},'"enabled": true')," in your\n",(0,i.kt)("a",{parentName:"p",href:"/pages/configs/artifactory_json"},"artifactory.json")," config file.\nThe file template contains documentation for other optional settings that can be used to customize\nthe dialogue."),(0,i.kt)("h2",{id:"see-also"},"See also"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/pages/commands/rush_setup"},"rush setup")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/pages/configs/artifactory_json"},"artifactory.json")," config file"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/pages/configs/npmrc"},".npmrc")," config file"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/pages/configs/npmrc-publish"},".npmrc-publish")," config file")))}h.isMDXComponent=!0}}]);